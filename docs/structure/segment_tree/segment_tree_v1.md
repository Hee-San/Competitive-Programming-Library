## 概要

各ノードが区間に対応した、完全二分木。

- 子は親の半分の区間を持つ
- モノイドについて、区間に対する演算が$O(log(n))$で処理できる。
  - 単位元の存在・結合律

### References

- セグメント木とは: [プログラミングコンテストでのデータ構造](https://www.slideshare.net/iwiwi/ss-3578491)
- 基本的な実装: [セグメント木をソラで書きたいあなたに](https://tsutaj.hatenablog.com/entry/2017/03/29/204841)
- 非再帰・1-indexed・非2冪: [非再帰セグ木サイコー！ 一番すきなセグ木です](https://hcpc-hokudai.github.io/archive/structure_segtree_001.pdf)
- 蟻本 p.153
- かつっぱさんの動画: [木マスター養成講座](https://www.youtube.com/watch?v=LjhVy1ZJTMc&list=PL3Hpv03CoZ24p5a6qT0LsFKEhiDWxf_B_&index=3)

## 使い方

> **v1**は、一点を更新・区間の演算結果を取得

`SegmentTree(n, f, id)` : サイズが`n`のセグメント木を作成する。

- `f` : 区間に対する演算（非可換にも対応）
- `id` : 単位元

ex.

- 区間和 : `SegmentTree<ll> seg(n, [](ll a, ll b) { return a + b; }, 0);`
- 区間max : `SegmentTree<ll> seg(n, [](ll a, ll b) { return max(a, b); }, 0);`
- 区間min : `SegmentTree<ll> seg(n, [](ll a, ll b) { return min(a, b); }, LLONG_MAX);`
- 区間xor : `SegmentTree<ll> seg(n, [](ll a, ll b) { return a ^ b; }, 0);`
- 区間GCD : `SegmentTree<ll> seg(n, [](ll a, ll b) { gcd(a, b); }, 0);`
- 区間LCM : `SegmentTree<ll> seg(n, [](ll a, ll b) { lcm(a, b); }, 1);`

`seg.build(A)` : 配列Aをセグメント木に設定する。

`seg.update(x, val)` : x番目の値をvalに更新する。

`seg.get(x)` : x番目の値を取得する。

`seg.get(l, r)` : 区間[l, r)についての演算結果を取得する。

`display(SegmentTree<T> seg, function<string(T)> t2str, int pattern = 0)` : セグメント木の中身を表示する。デバッグ用。

## 計算量

- `build(A)` : $O(n)$
- `update(x, val)` : $O(log(n))$
- `get(x)` : $O(1)$
- `get(l, r)` : $O(log(n))$

## NOTE

- vector `seg.seg` は1-indexedである。
- `f` は非可換演算にも対応できる。
- `n`が2の冪でない場合にも対応できる。

### 例 (非可換・非2冪)

```cpp
int N = 11;
vs A = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"};

SegmentTree<string> seg(N, [](string a, string b) { return a + b; }, "");
seg.build(A);
cout << "seg.get(0, 11) : " << seg.get(0, 11) << endl;
cout << "seg.get(1, 8) : " << seg.get(1, 8) << endl;

function<string(string)> f = [](string a) { return a; };
display(seg, f, 0);
cout << endl;
display(seg, f, 1);
```

```txt
seg.get(0, 11) : 012345678910
seg.get(1, 8) : 1234567
|------------------------------------------------------|
|                          [1]                         |
|                           /                          |
|                     567891001234                     |
|------------------------------------------------------|
|                [2]               |        [3]        |
|                 /                |       [1,5)       |
|             56789100             |        1234       |
|------------------------------------------------------|
|        [4]        |      [5]     |   [6]   |   [7]   |
|       [5,9)       |       /      |  [1,3)  |  [3,5)  |
|        5678       |     9100     |    12   |    34   |
|------------------------------------------------------|
|   [8]   |   [9]   |   [10]  |[11]|[12]|[13]|[14]|[15]|
|  [5,7)  |  [7,9)  |  [9,11) |  0 |  1 |  2 |  3 |  4 |
|    56   |    78   |   910   |  0 |  1 |  2 |  3 |  4 |
|------------------------------------------------------|
|[16]|[17]|[18]|[19]|[20]|[21]|
|  5 |  6 |  7 |  8 |  9 | 10 |
|  5 |  6 |  7 |  8 |  9 | 10 |
|-----------------------------|

     |---------------------------------------|
     |        [3]        |        [4]        |
     |       [1,5)       |       [5,9)       |
     |        1234       |        5678       |
     |-------------------------------------------------|
     |   [6]   |   [7]   |   [8]   |   [9]   |   [10]  |
     |  [1,3)  |  [3,5)  |  [5,7)  |  [7,9)  |  [9,11) |
     |    12   |    34   |    56   |    78   |   910   |
|------------------------------------------------------|
|[11]|[12]|[13]|[14]|[15]|[16]|[17]|[18]|[19]|[20]|[21]|
|  0 |  1 |  2 |  3 |  4 |  5 |  6 |  7 |  8 |  9 | 10 |
|  0 |  1 |  2 |  3 |  4 |  5 |  6 |  7 |  8 |  9 | 10 |
|------------------------------------------------------|
```
